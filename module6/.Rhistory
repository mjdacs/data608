intall.packages("tidyverse")
ininstall.packages("tidyverse")
install.packages("tidyverse")
install.packages("shiny")
library(shiny)
ui <- fluidPage(
"Hello world"
)
server <- function(input, output, session) {
}
shinyApp(ui, server)
library(dplyr)
library(plotly)
library(shiny); runApp('Code/CUNY/data608/module3/Sample Apps/plotly-simple.R')
runApp('Code/CUNY/data608/module3/Sample Apps/plotly-simple.R')
runApp('Code/CUNY/data608/module3/Sample Apps/plotly-simple.R')
library(tidyverse)
data <- read_csv("http://web.mta.info/developers/data/nyct/turnstile/turnstile_191123.txt")
dim(data)
colnames(data)
unique(data$LINENAME)
sapply(data, function(x) sum(is.na(x)))
unique(data$DIVISION)
df <- data %>% filter(DIVISION %in% c("BMT", "IND", "IRT"))
df
df$TIME <- as.character(df$TIME)
df$ENTRIES <- as.numeric(df$ENTRIES)
df$EXITS <- as.numeric(df$EXITS)
head(df)
df$TIME <- as.character(df$TIME)
df$ENTRIES <- as.integer(df$ENTRIES)
df$EXITS <- as.integer(df$EXITS)
head(df)
unique(df$TIME)
df %>% filter(TIME == "06:39:58")
df %>% filter(STATION == "ATL AV-BARCLAY")
# dfdt <- df %>% filter(TIME %in% c("03:00:00", "07:00:00", "11:00:00" ,"15:00:00", "19:00:00", "23:00:00",
#                           "01:00:00", "05:00:00", "09:00:00", "13:00:00", "17:00:00", "21:00:00",
#                           "00:00:00", "04:00:00" ,"08:00:00", "12:00:00", "16:00:00", "20:00:00" ,
#                           "02:00:00" ,"06:00:00" ,"10:00:00", "14:00:00" ,"18:00:00", "22:00:00" ))
# dfdt <- df %>% filter(DATE %in% c("11/16/2019", "11/22/2019"),
#                     TIME %in% c("03:00:00", "23:00:00",
#                                 "01:00:00", "21:00:00",
#                                 "00:00:00", "20:00:00",
#                                 "02:00:00", "22:00:00" ))
dfdt <- df %>%
filter(
(DATE == "11/16/2019" & TIME %in% c("00:00:00","01:00:00","02:00:00","03:00:00")) |
(DATE == "11/22/2019" & TIME %in% c("20:00:00","21:00:00","22:00:00", "23:00:00"))
)
df_audit1 <- df %>%
filter(
(DATE == "11/16/2019" & TIME %in% c("00:00:00")) |
(DATE == "11/22/2019" & TIME %in% c("20:00:00"))
)
df_audit2 <- df %>%
filter(
(DATE == "11/16/2019" & TIME %in% c("01:00:00")) |
(DATE == "11/22/2019" & TIME %in% c("21:00:00"))
)
df_audit3 <- df %>%
filter(
(DATE == "11/16/2019" & TIME %in% c("02:00:00")) |
(DATE == "11/22/2019" & TIME %in% c("22:00:00"))
)
df_audit4 <- df %>%
filter(
(DATE == "11/16/2019" & TIME %in% c("03:00:00")) |
(DATE == "11/22/2019" & TIME %in% c("23:00:00"))
)
#
# dfdt %>% filter(DATE == "11/16/2019" & TIME %in% c("00:00:00",
#                                                   "01:00:00",
#                                                   "02:00:00",
#                                                   "03:00:00") )
dfdt
df_audit1
df1 <- df_audit1 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "ALLERTON AV" & !SCP %in% c("00-00-00"),
STATION != "125 ST" & !SCP %in% c("00-05-01"),
STATION != "WTC-CORTLANDT" & !SCP %in% c("00-03-00","03-00-00","03-00-01","03-00-02")) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df1
df_audit1 %>%
select(SCP, STATION, DATE, TIME, DESC, ENTRIES, EXITS) %>%
filter(STATION == "96 ST")
df_audit2
df2 <- df_audit2 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df2
df_audit3
df3 <- df_audit3 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df3
df_audit4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
clean_df <- bind_rows(df1, df2, df3, df4)
clean_df <- clean_df %>% group_by(STATION) %>%
summarise(Week_Total_Entries = sum(Week_Total_Entries),
Week_Total_Exits = sum(Week_Total_Exits)) %>%
arrange(desc(Week_Total_Entries))
setwd("~/Code/CUNY/data608/module6")
unique(data$LINENAME)
station_sets[1]
station_sets = unique(data$LINENAME)
station_sets[1]
lenght(station_sets[1])
import stringr
library(stringr)
str_length(station_sets[1])
station_sets = unique(data$LINENAME)
count = 0
for (i in station_sets) {
if (str_length(i) == 1) {
count = count + 1
}
}
count
station_sets = unique(data$LINENAME)
stations <- vector(mode = "list", length = 20)
for (i in station_sets) {
if (str_length(i) == 1) {
stations = c(stations, i)
}
}
stations
station_sets = unique(data$LINENAME)
stations <- c()
for (i in station_sets) {
if (str_length(i) == 1) {
stations = c(stations, i)
}
}
stations
data_viz_hi <- head(clean_df,20) %>%
mutate(Total_Traffic = Week_Total_Entries + Week_Total_Exits) %>%
select(STATION, LINENAMES, Total_Traffic) %>%
arrange(desc(Total_Traffic))
data_viz_hi <- head(clean_df,20) %>%
mutate(Total_Traffic = Week_Total_Entries + Week_Total_Exits) %>%
select(STATION,Total_Traffic) %>%
arrange(desc(Total_Traffic))
data_viz_hi
clean_df
clean_df <- bind_rows(df1, df2, df3, df4)
clean_entries <- clean_df %>% group_by(STATION) %>%
summarise(Week_Total_Entries = sum(Week_Total_Entries),
Week_Total_Exits = sum(Week_Total_Exits)) %>%
arrange(desc(Week_Total_Entries))
clean_df
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
select(LINENAME) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
select(STATION, LINENAME, Total_Enter, Total_Exit) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(lines = LINENAMES,
Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(lines = LINENAME,
Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
)
df4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION, LINENAME) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION, LINENAME) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
df4 <- df_audit4 %>%
mutate(Total_Enter = ENTRIES - lag(ENTRIES, 1),
Total_Exit = EXITS - lag(EXITS, 1)) %>%
filter(Total_Enter > 0 & DATE == "11/22/2019") %>%
group_by(STATION) %>%
filter(STATION != "42 ST-PORT AUTH" & !SCP %in% c("00-00-08", "00-00-09"),
STATION != "RECTOR ST" & !SCP %in% c("01-03-00", "01-06-00"),
STATION != "47-50 STS ROCK" & !SCP %in%
c("02-06-00","02-06-01",
"02-03-00","02-03-01","02-03-02","02-03-03",
"01-03-02",
"00-03-00", "00-03-01","00-03-02","00-03-03","00-03-04","00-03-05"),
STATION != "86 ST" & !SCP %in%
c("00-00-00", "00-00-01", "00-03-00", "00-03-01", "00-03-02")
) %>%
summarise(Week_Total_Entries = sum(Total_Enter),
Week_Total_Exits = sum(Total_Exit)) %>%
arrange(desc(Week_Total_Entries))
df4
df_audit4 %>% group_by(STATION, LINENAME)
df_audit4 %>% group_by(STATION, LINENAME) %>% arrange()
df_audit4 %>% select(STATION, LINENAME) group_by(STATION) %>% arrange()
df_audit4 %>% select(STATION, LINENAME) %>% group_by(STATION) %>% arrange()
df_audit4 %>% select(STATION, LINENAME) %>% group_by(STATION) %>% summarize()
df_audit4 %>% select(STATION, LINENAME)
df %>% select(STATION, LINENAME)
names = df %>% select(STATION, LINENAME)
names
map(names$STATION, names$LINENAME)
names = df %>% select(STATION, LINENAME, ENTRIES) %>% group_by(STATION, LINENAME) %>% summarise(avg.entries = mean(ENTRIES))
names
